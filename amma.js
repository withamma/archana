// Generated by CoffeeScript 1.7.1
var app;

app = angular.module("linear-learning", ["ngRoute", "ngFitText", "ui.bootstrap", 'ngStorage']);

app.config(function($routeProvider) {
  return $routeProvider.when("/", {
    controller: "ItemListerCtrl",
    templateUrl: "item-lister.template"
  }).when("/memorize/:itemId", {
    controller: "MemorizeCtrl",
    templateUrl: "test.template"
  }).when("/results/:itemId", {
    controller: "ResultsCtrl",
    templateUrl: "results.template"
  }).otherwise({
    redirectTo: "/"
  });
});

app.controller("ItemListerCtrl", [
  "$scope", "$http", function($scope, $http) {
    return $http.get("learning-items.json").success(function(data) {
      return $scope.items = data;
    });
  }
]);

app.controller("MemorizeCtrl", [
  "$scope", '$routeParams', '$http', "$location", '$localStorage', function($scope, $routeParams, $http, $location, storage) {
    var id, incorrect, log, nextState;
    id = "" + $routeParams.itemId;
    $scope.state = "loading";
    if (storage[id] == null) {
      storage[id] = {};
      storage[id]["currentPosition"] = 0;
      storage[id]["log"] = {};
    }
    storage[id]["incorrect"] = [];
    $scope.currentPosition = storage[id]["currentPosition"];
    log = storage[id]["log"];
    incorrect = storage[id]["incorrect"];
    $http.get("learn/" + $routeParams.itemId + ".json").success(function(data) {
      $scope.listToLearn = data.list;
      $scope.title = data.title;
      return $scope.state = "show";
    });
    $scope.showAnswer = function() {
      return $scope.state = "answer";
    };
    nextState = function() {
      if ($scope.currentPosition + 2 < $scope.listToLearn.length) {
        $scope.currentPosition += 1;
        storage[id]["currentPosition"] = $scope.currentPosition;
        return $scope.state = "show";
      } else {
        $scope.state = "end";
        return storage[id]["currentPosition"] = 0;
      }
    };
    $scope.submitAnswer = function(result) {
      if (result === "correct") {
        log[$scope.currentPosition] = {
          "correct": true
        };
      } else {
        log[$scope.currentPosition] = {
          "correct": false
        };
        incorrect.push({
          "previous": $scope.linkPrevious(),
          "next": $scope.linkTest()
        });
      }
      return nextState();
    };
    $scope.linkPrevious = function() {
      if ($scope.state !== "loading") {
        return $scope.listToLearn[$scope.currentPosition];
      } else {
        return "Loading";
      }
    };
    $scope.linkTest = function() {
      if ($scope.state === "answer") {
        return $scope.listToLearn[$scope.currentPosition + 1];
      } else {
        return "?";
      }
    };
    return $scope.showResults = function() {
      return $location.path("results/" + id);
    };
  }
]);

app.controller("ResultsCtrl", [
  "$scope", "$localStorage", '$routeParams', function($scope, $localStorage, $routeParams) {
    var id;
    id = "" + $routeParams.itemId;
    return $scope.incorrect = $localStorage[id]["incorrect"];
  }
]);
